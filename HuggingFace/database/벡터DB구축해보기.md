## 벡터 DB 를 사용해보자.

(1) elasticsearch 다운로드
링크:  https://www.elastic.co/guide/en/elasticsearch/reference/current/zip-windows.html
파일 : https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.14.1-windows-x86_64.zip 
다운로드 후 압축을 풀고 elasticsearch-8.14.1-windows-x86_64 이 폴더를 
나는 C:\Users\litl\Elasticsearch 경로 생성 후 옮겨 주었다.

(2) elasticsearch 서버 실행
cmd 를 열고 서버를 실행시키자.
in cmd
C:\Users\litl
$ cd Elasticsearch/elasticsearch-8.14.1-windows-x86_64/elasticsearch-8.14.1
$ bin\elasticsearch.bat

+ 인코딩 변경
실행되었으나, 인코딩이 깨져서 로그가 출력되었다.
인코딩은 cp949 로 바꿔주자. (Ctrl+C 로 엘라스틱서치 서버 종료 후 시도)
$ chcp 65001
>> 결과: Active code page: 65001
>

(3) elasticvue 다운로드
엘라스틱 뷰는 pycharm 처럼 독립 실행형 프로그램이 아닌 웹 브라우저 기반 확장 프로그램이라고 한다.
Chrome 을 통해 설치하자.
경로 : https://chromewebstore.google.com/search/elasticvue?utm_source=ext_app_menu
크롬 웹 확장프로그램에 elasticvue 를 추가해주자.
추가 후 툴바에 고정해 주고 클릭하면, elasticvue 메인 페이지가 나온다.

+ ADD ELASTICSEARCH CLUSTER 를 클릭하면 No authorization 과 basic auth 가 나온다.
회사에서 사용하는 것 처럼 basic auth 를 사용해보자.
이를 위해선, elasticsearh 서버의 보안을 설정해야 한다.

(4) Elasticsearch 보안 설정하기
먼저, 서버가 구동 중이라면 Ctrl C 로 중지하자.
(4-1) elasticsearch.yml 확인하기.
xpack.security.enabled: true # 상태여야 보안 기능이 활성화 된 것이다. (기본도 true 였기에 사실 변경은 없다.)
(4-2) 사용자 비밀번호 설정하기.
비밀번호 설정은 서버를 구동시킨 후 해야한다. 
$ bin/elasticsearch.bat
서버가 실행되면, 새로운 cmd 터미널을 열어서 elasticsearch 의 bin 폴더까지 들어간 후, 아래 명령어를 입력하자.
엘라스틱 서치에는 기본 내장 사용자 계정이 있기 떄문에, 비밀번호만 설정하면 된다고 한다.
$ elasticsearch-setup-passwords interactive
>> 결과 :
> Failed to authenticate user 'elastic' against https://172.30.28.238:9200/_security/_authenticate?pretty
Possible causes include:
 * The password for the 'elastic' user has already been changed on this cluster
 * Your elasticsearch node is running against a different keystore
   This tool used the keystore at C:\Users\litl\Elasticsearch\elasticsearch-8.14.1-windows-x86_64\elasticsearch-8.14.1\config\elasticsearch.keystore

You can use the `elasticsearch-reset-password` CLI tool to reset the password of the 'elastic' user


ERROR: Failed to verify bootstrap password, with exit code 78
실패했다. reset 명령어를 사용하라고 하니 따라해보자.

$ elasticsearch-reset-password -u elastic
>> 결과:
This tool will reset the password of the [elastic] user to an autogenerated value.
The password will be printed in the console.
Please confirm that you would like to continue [y/N]y

Password for the [elastic] user successfully reset.
New value: YtMfkN2Cfjh6ln8qL2Ol

y 를 입력하자, 자동으로 랜덤 비밀번호가 생성되었다. 어딘가에 잘 저장해두자. 

(5)  elastic vue 시작하기
+ ADD ELASTICSEARCH CLUSTER 클릭 -> basic auth
cluster name : default cluster
Username : elastic
Password : 아까 자동으로 생성된 비밀번호
Uri : http://localhost:9200
cmd 에서 보이는 9300 포트는 엘라스틱 서치에서 클러스터 내 노드 간 통신을 위한 포트라고 한다.
HTTP 서비스를 제공하는 기본 포트는 9200 이므로 9200 을 입력해준다.

http://localhost:9200
하지만 접속이 안되었다.
elasticsearch 서버 구동 시의 로그를 살펴보니
received plaintext http traffic on an https channel, closing connection 라는 메세지가 있었다.
서버가 HTTP가 아닌 HTTPS 연결만을 수락하도록 설정되어, 
HTTP로 연결을 시도할 경우 서버가 연결을 종료한다는 것을 알려준다.

https://localhost:9200 으로 연결해보자
여전히 안되었다. 인증서문제인듯 하다.
http 는 데이터가 암호화되지 않은 상태로 전송 되고,
https 는 SSL/TLS 프로토콜을 사용하여 데이터가 암호화된 상태로 전송 되는 것으로,
https 를 사용해 주어야 하므로 방법을 찾아보자.

+ 인증서 생성하기
chrome 에서 https://localhost:9200/ 안전하지 않음 으로 이동
이동하자, 로그인 alert 창이 떴다. id와 pw 에 elasticsearch의 계정과 비밀번호를 입력한다.
id : elastic
pw : 랜덤으로 생성되었었던 그 비밀번호

>> 결과 : 
{
  "name" : "BOOK-MB2VJ96366",
  "cluster_name" : "elasticsearch",
  "cluster_uuid" : "-fQT8bwcSW2ZEXEfkkmytg",
  "version" : {
    "number" : "8.14.1",
    "build_flavor" : "default",
    "build_type" : "zip",
    "build_hash" : "93a57a1a76f556d8aee6a90d1a95b06187501310",
    "build_date" : "2024-06-10T23:35:17.114581191Z",
    "build_snapshot" : false,
    "lucene_version" : "9.10.0",
    "minimum_wire_compatibility_version" : "7.17.0",
    "minimum_index_compatibility_version" : "7.0.0"
  },
  "tagline" : "You Know, for Search"
}

다시 elasticvue 로 돌아가서 connect 가 success 되었다!

이제 벡터 DB를 사용해보자!